<div class="users-container">
  <!-- Success Alert -->
  @if (showSuccessAlert) {
    <div class="alert-container">
      <app-alert
        type="success"
        [message]="successMessage"
        [dismissible]="true"
        [autoClose]="true"
        [autoCloseDelay]="5000"
        (dismiss)="dismissAlert()">
      </app-alert>
    </div>
  }

  <div class="page-header">
    <h2>Users Management</h2>
    <app-button variant="primary" (btnClick)="addUser()">
      Add New User
    </app-button>
  </div>

  <app-card>
    <div class="search-bar">
      <input
        type="text"
        placeholder="Search users by name, email, role, or status..."
        class="search-input"
        (input)="onSearch($event)"
      />
    </div>

    <app-table
      [columns]="columns"
      [data]="filteredUsers"
      [loading]="loading"
      [striped]="true"
      [hoverable]="true"
      [paginate]="true"
      [pageSize]="10"
      (sort)="onSort($event)"
      (rowClick)="onRowClick($event)">
    </app-table>
  </app-card>

  <!-- Add User Modal -->
  <app-modal
    [isOpen]="showAddUserModal"
    [title]="'Add New User'"
    [size]="'md'"
    (closeModal)="closeAddUserModal()"
    [showFooter]="false">

    <form [formGroup]="addUserForm" (ngSubmit)="submitAddUser()" class="add-user-form">
      <div class="form-group">
        <label for="name" class="form-label required">Name</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          class="form-input"
          [class.error]="addUserForm.get('name')?.invalid && addUserForm.get('name')?.touched"
          placeholder="Enter user's full name"
        />
        @if (addUserForm.get('name')?.invalid && addUserForm.get('name')?.touched) {
          <div class="error-messages">
            @if (addUserForm.get('name')?.errors?.['required']) {
              <small class="error-text">Name is required</small>
            }
            @if (addUserForm.get('name')?.errors?.['minlength']) {
              <small class="error-text">Name must be at least 3 characters</small>
            }
          </div>
        }
      </div>

      <div class="form-group">
        <label for="email" class="form-label required">Email</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          class="form-input"
          [class.error]="addUserForm.get('email')?.invalid && addUserForm.get('email')?.touched"
          placeholder="Enter user's email address"
        />
        @if (addUserForm.get('email')?.invalid && addUserForm.get('email')?.touched) {
          <div class="error-messages">
            @if (addUserForm.get('email')?.errors?.['required']) {
              <small class="error-text">Email is required</small>
            }
            @if (addUserForm.get('email')?.errors?.['email']) {
              <small class="error-text">Please enter a valid email address</small>
            }
          </div>
        }
      </div>

      <div class="form-group">
        <label for="role" class="form-label required">Role</label>
        <select
          id="role"
          formControlName="role"
          class="form-input">
          <option value="Admin">Admin</option>
          <option value="Moderator">Moderator</option>
          <option value="User">User</option>
        </select>
      </div>

      <div class="form-group">
        <label for="status" class="form-label required">Status</label>
        <select
          id="status"
          formControlName="status"
          class="form-input">
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
      </div>

      <div class="form-actions">
        <app-button
          type="button"
          variant="secondary"
          (btnClick)="closeAddUserModal()"
          [disabled]="submitting">
          Cancel
        </app-button>
        <app-button
          type="submit"
          variant="primary"
          [disabled]="addUserForm.invalid || submitting"
          [loading]="submitting">
          Add User
        </app-button>
      </div>
    </form>
  </app-modal>
</div>